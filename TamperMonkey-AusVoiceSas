// ==UserScript==
// @name         Fast Australian Voice Override
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  Fast Australian speech synthesis voice override
// @author       You
// @match        https://*
// @match        http://*
// @grant        none
// @run-at       document-start
// ==/UserScript==

(function() {
    'use strict';

    let cachedAustralianVoice = null;
    let voicesLoaded = false;

    console.log('ðŸ‡¦ðŸ‡º Fast Australian voice override loading...');

    function cacheAustralianVoice() {
        const voices = speechSynthesis.getVoices();

        if (voices.length === 0) return false;

        // Find Australian voice (prioritize online/neural voices)
        cachedAustralianVoice = voices.find(voice => {
            const name = voice.name.toLowerCase();
            const lang = voice.lang.toLowerCase();

            return (
                (lang.includes('en-au') || name.includes('australia')) &&
                (name.includes('natural') || name.includes('neural') || !voice.localService)
            );
        }) || voices.find(voice => {
            const name = voice.name.toLowerCase();
            const lang = voice.lang.toLowerCase();
            return lang.includes('en-au') || name.includes('australia');
        });

        if (cachedAustralianVoice) {
            console.log('âœ… Cached Australian voice:', cachedAustralianVoice.name);
            voicesLoaded = true;
            return true;
        } else {
            console.log('âŒ No Australian voice found');
            return false;
        }
    }

    // Override speech synthesis immediately
    const originalSpeak = speechSynthesis.speak;
    speechSynthesis.speak = function(utterance) {
        // Use cached voice if available
        if (cachedAustralianVoice) {
            utterance.voice = cachedAustralianVoice;
        }

        return originalSpeak.call(this, utterance);
    };

    // Try to cache voice immediately
    if (cacheAustralianVoice()) {
        console.log('ðŸ‡¦ðŸ‡º Australian voice ready');
    } else {
        // If voices not loaded yet, wait for them (but don't delay speech)
        speechSynthesis.onvoiceschanged = function() {
            if (!voicesLoaded) {
                cacheAustralianVoice();
            }
        };

        // Fallback: try again after short delay
        setTimeout(() => {
            if (!voicesLoaded) {
                cacheAustralianVoice();
            }
        }, 1000);
    }

    console.log('ðŸ‡¦ðŸ‡º Fast override active');
})();